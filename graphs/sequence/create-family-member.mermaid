sequenceDiagram
    autonumber
    participant User as Family Manager
    participant Frontend
    participant FamilyMembersController
    participant FamilyMembersService
    participant Cloudinary
    participant Database
    participant JWT
    participant RolesGuard
    Note over User,RolesGuard: 1. Authentication & Authorization
    User->>Frontend: Login with credentials
    Frontend->>JWT: POST /auth/login-base
    JWT-->>Frontend: access_token with user role
    Frontend-->>User: Authenticated
    Note over User,Database: 2. Family Member Creation
    User->>Frontend: Add family member<br/>{familyId, fullName, gender, dateOfBirth, generation, ...}
    Frontend->>FamilyMembersController: POST /member<br/>Authorization: Bearer {access_token}<br/>Body: MemberDto + optional avatar file
    FamilyMembersController->>JWT: validate token
    JWT-->>FamilyMembersController: userId from payload
    FamilyMembersController->>RolesGuard: check user role
    RolesGuard->>Database: verify user role (EDITOR/OWNER)
    Database-->>RolesGuard: role confirmed
    RolesGuard-->>FamilyMembersController: role validation passed
    FamilyMembersController->>FamilyMembersService: create(MemberDto, file?)
    FamilyMembersService->>Database: verify family exists and user has access
    Database-->>FamilyMembersService: family access confirmed
    alt Avatar file provided
        FamilyMembersService->>Cloudinary: upload avatar image
        Cloudinary-->>FamilyMembersService: {secure_url, public_id}
        FamilyMembersService->>FamilyMembersService: set avatarUrl = secure_url
    else No avatar provided
        FamilyMembersService->>FamilyMembersService: avatarUrl remains null
    end
    FamilyMembersService->>Database: create FamilyMember<br/>{familyId, fullName, gender, dateOfBirth, generation, avatarUrl, ...}
    Database-->>FamilyMembersService: newFamilyMember created
    FamilyMembersService-->>FamilyMembersController: family member created
    FamilyMembersController-->>Frontend: success response with member data
    Frontend-->>User: Family member added successfully
    Note over User,Database: 3. Optional: View Family Members
    User->>Frontend: View family members
    Frontend->>FamilyMembersController: GET /member/{familyId}
    FamilyMembersController->>FamilyMembersService: getAll(familyId)
    FamilyMembersService->>Database: find all FamilyMember where familyId
    Database-->>FamilyMembersService: array of family members
    FamilyMembersService-->>FamilyMembersController: members list
    FamilyMembersController-->>Frontend: members data
    Frontend-->>User: Display family tree members
    Note over User,Database: 4. Optional: Create Relationships
    User->>Frontend: Add relationship between members
    Frontend->>RelationshipController: POST /relationship<br/>(separate controller)
    RelationshipController->>Database: create Relationship<br/>{fromMemberId, toMemberId, type}
    Database-->>RelationshipController: relationship created
    RelationshipController-->>Frontend: relationship data
    Frontend-->>User: Relationship established